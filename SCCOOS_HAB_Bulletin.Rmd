---
title: "SCCOOS CA HAB Bulletin Data and Plots"
author: "Megan Hepner"
date: "7/20/2018"
output: html_document
---

```{r Libraries}
knitr::opts_chunk$set(echo = TRUE)

#rm(list=ls()) 
getwd()
#setwd("/Volumes/GoogleDrive/My Drive/SCCOOS")
library(cowplot) #get_legend 
library(dygraphs) #dygraphs 
library(ggplot2) #ggplot
library(tidyverse)
library(vegan) #spec, diversity
library(htmlwidgets)
library(xts)
library(lubridate) 
library(zoo) #as.yearmon
library(shiny)
library(grid) #unit.pmax
library(gridExtra)#grid.arrange 
library(gtable) #ggplotGrob #rbind 
library(scales) #scale_x_date

#Conflicts: 
#dplyr::filter()   masks stats::filter()
#cowplot::ggsave() masks ggplot2::ggsave()
#dplyr::lag()      masks stats::lag()

select = dplyr::select #override MASS::select 
group_by =  dplyr::group_by #override plotly::group_by
summarise = dplyr::summarise #override plotly::summarise
filter = dplyr::filter

```

## California Department of Public Health (CDPH) Data

California Department of Public Health weekly observations for *Pseudo-nitzschia spp* and *Alexandrium spp.* 

Density Codes:
R = Rare (1)
P = Present (2)
C = Common (3)
A = Abundant (4)

The RAI is based on the sampling effort (total tow length), percent composition, and settled cell mass (in milliliters).

```{r May 2019 CDPH data}

Pn_2019_06_wk1 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/2019_06_week_1_Pn.csv") 
Pn_2019_06_wk2 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/2019_06_week_2_Pn.csv") 
Pn_2019_06_wk3 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/2019_06_week_3_Pn.csv")
Pn_2019_06_wk4 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/2019_06_week_4_Pn.csv") 

CDPH_Pn_2019_06 = dplyr::bind_rows(Pn_2019_06_wk1, Pn_2019_06_wk2) 
CDPH_Pn_2019_06 = dplyr::bind_rows(CDPH_Pn_2019_06, Pn_2019_06_wk3) 
CDPH_Pn_2019_06 = dplyr::bind_rows(CDPH_Pn_2019_06, Pn_2019_06_wk4) 

#CDPH_Pn_2019_06 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/2019_06_Pn.csv")

CDPH_Pn_2019_06 = CDPH_Pn_2019_06 %>% #
  select(`Date -Sampled-`,`Sample Site`,`Percent Composition`,`Density -code-`,`RA Index`,Latitude,Longitude)

write_csv(CDPH_Pn_2019_06, "/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/CDPH_Pn_2019_06.csv")

CDPH_Pn_2019_06_max = CDPH_Pn_2019_06 %>%  
  group_by(`Sample Site`,Latitude,Longitude) %>%
  summarize(
    percent_composition_max = max(`Percent Composition`))%>%
  #arrange(Sample_Site) %>%
  arrange(percent_composition_max) 

write_csv(CDPH_Pn_2019_06_max, "/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Pseudo_nitzschia/2019_06/CDPH_Pn_2019_06_max.csv")

Al_2019_06_wk1 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/2019_06_week_1_Al.csv")  
Al_2019_06_wk2 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/2019_06_week_2_Al.csv")  
Al_2019_06_wk3 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/2019_06_week_3_Al.csv")  
Al_2019_06_wk4 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/2019_06_week_4_Al.csv")  

CDPH_2019_06 = dplyr::bind_rows(Al_2019_06_wk1, Al_2019_06_wk2) 
CDPH_2019_06 = dplyr::bind_rows(CDPH_2019_06, Al_2019_06_wk3) 
CDPH_2019_06 = dplyr::bind_rows(CDPH_2019_06, Al_2019_06_wk4) 

#CDPH_2019_06 = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/2019_06_Al.csv")

CDPH_Al_2019_06 = CDPH_2019_06 %>%
  select(`Date -Sampled-`,`Sample Site`,`Percent Composition`,`Density -code-`,`RA Index`,Latitude,Longitude)

write_csv(CDPH_Al_2019_06, "/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/CDPH_Al_2019_06.csv")

CDPH_Al_2019_06_max = CDPH_Al_2019_06 %>% 
  group_by(`Sample Site`,Latitude,Longitude) %>%
  summarize(
    percent_composition_max = max(`Percent Composition`))%>%
  #arrange(Sample_Site) %>%
  arrange(percent_composition_max) #24x4
write_csv(CDPH_Al_2019_06_max, "/Volumes/GoogleDrive/My Drive/SCCOOS/CDPH/CDPH_Data/Alexandria/2019_06/CDPH_Al_2019_06_max.csv")

```

## The Marine Mammal Center Data 

```{r TMMC Monthly Mean 1990 to Present}

#TMMC Stranding Data 1998 to 2018 Monthly Mean and Standard Error 

TMMC_marine_mammal = read_csv('/Volumes/GoogleDrive/My Drive/SCCOOS/TMMC/TMMC_Data/1998-2019_TMMC_DA.csv')

TMMC_marine_mammal_summarized= TMMC_marine_mammal %>%
  select(Strand_Date,Occurrence) %>% 
  mutate(Year = format(as.Date(Strand_Date, format ="%Y-%m-%d"),"%Y"),
         Month = format(as.Date(Strand_Date, format ="%Y-%m-%d"),"%m"),
         Day = format(as.Date(Strand_Date, format ="%Y-%m-%d"),"%d"))%>%
  filter(Year != "2019")%>% 
  group_by(Year, Month) %>%
  summarise(Occurence_YM = length(Occurrence))

TMMC_Monthly_Mean = TMMC_marine_mammal_summarized %>% 
   group_by(Month) %>%
   summarise(
     Monthly_mean = mean(Occurence_YM),
     Monthly_n = length(Occurence_YM),
     Monthly_sd = sd(Occurence_YM),
     Monthly_se = Monthly_sd / sqrt(Monthly_n),
     Monthly_min = min(Occurence_YM),
     Monthly_max = max(Occurence_YM))
write_csv(TMMC_Monthly_Mean, "/Volumes/GoogleDrive/My Drive/SCCOOS/TMMC/TMMC_Data/TMMC_monthly_mean_1998-2018.csv")

#TMMC_Monthly_Mean = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/Strandings_Data/Data/TMMC_monthly_mean_1998-2018.csv")

#Plot TMMC Monthly Mean and 2019 Data by Rehabilitation Center  

TMMC_Monthly_Mean = read_csv("~/Google Drive File Stream/My Drive/SCCOOS/CA_HAB_Bulletin/Strandings_Data/Data/TMMC_monthly_mean_1998-2018.csv")

TMMC_Monthly_Plot = ggplot(TMMC_Monthly_Mean, aes(x= Month, y=Monthly_mean))+
  geom_line(aes(y=Monthly_mean), color = "grey0",lwd = 1.5)+
  geom_point(aes(y=Monthly_mean), color = "grey0",size=5)+
  geom_errorbar(aes(ymax=Monthly_mean+Monthly_se, ymin=Monthly_mean-Monthly_se), width=0.1,color = "grey0")+
  geom_line(aes(y=`TMMC_2019`), color= "red", lwd = 1.5)+
  geom_point(aes(y=`TMMC_2019`),color= "red", size=5)+
  geom_line(aes(y=MMCCLA_MAR_CWC_2019), color= "blue", lwd = 1.5)+
  geom_point(aes(y=MMCCLA_MAR_CWC_2019), color="blue", size=5)+
  geom_line(aes(y=`PMMC_2019`), color= "orange", lwd = 1.5)+
  geom_point(aes(y=`PMMC_2019`), color= "orange", size=5)+
  geom_line(aes(y=`SeaWorld_2019`), color="purple", lwd = 1.5)+
  geom_point(aes(y=`SeaWorld_2019`), color="purple", size=5)+
  labs(title= "Marine Mammal Strandings due to Suspected DA Toxicosis", x="2019", y="Number of Strandings (± SE)", color=NULL) + 
  scale_x_continuous(
    limits = c(1, 12), 
    breaks = c(1,2,3,4,5,6,7,8,9,10,11,12), 
    labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))+
   scale_y_continuous(
    limits = c(0, 50), 
    breaks = c(0,5,10,15,20,25,30,35,40,45, 50), 
    labels=c("0","5","10","15","20","25","30","35","40","45","50"))+
  theme_bw()+
  theme(
    #legend.position = c(0.8,0.9),
    #legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    #legend.title = element_blank(),
    #legend.justification = "center",
    #legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    #legend.text = element_text(size=16, vjust=0.5, hjust=0), 
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=16, color="black"),
    axis.title.y=element_text(size=16, color="black"),
    axis.text.x = element_text(size=16, color="black"),
    axis.text.y = element_text(size=16, color="black"),
    title=element_text(size=18),
    plot.title=element_text(hjust=0.5))

ggsave(file="Stranding_Counts_2019_06.png", width=10, height =6 , path="~/Google Drive File Stream/My Drive/SCCOOS/CA_HAB_Bulletin/Strandings_Data/Plots")


TMMC_Monthly_Plot_Legend = ggplot(TMMC_Monthly_Mean, aes(x= Month, y=Monthly_mean))+
  geom_line(aes(y=Monthly_mean, color ="grey0"), lwd = 1)+
  geom_point(aes(y=Monthly_mean, color ="grey0"), size=3)+
  geom_errorbar(aes(ymax=Monthly_mean+Monthly_se, ymin=Monthly_mean-Monthly_se), width=0.1, color ="grey0")+
  geom_line(aes(y=`TMMC_2019`, color="red" ), lwd = 1)+
  geom_point(aes(y=`TMMC_2019`, color="red"), size=5)+
  geom_line(aes(y=MMCCLA_MAR_CWC_2019, color="blue"), lwd = 1)+
  geom_point(aes(y=MMCCLA_MAR_CWC_2019, color="blue"), size=5)+
  geom_line(aes(y=`PMMC_2019`, color="orange"), lwd = 1)+
  geom_point(aes(y=`PMMC_2019`, color="orange"), size=5)+
  geom_line(aes(y=`SeaWorld_2019`, color="purple"), lwd = 1)+
  geom_point(aes(y=`SeaWorld_2019`, color="purple"), size=5)+
  labs(title= "", x="2019", y="Number of Strandings (± SE)", color = NULL) + 
  scale_color_manual(
    labels=c("TMMC Mean Strandings since 1998","The Marine Mammal Center (TMMC)","Ca Wildlife Center (CWC)\nMarine Mammal Care Center LA (MMCC-LA)\nMarine Animal Rescue (MAR)", "Pacific Marine Mammmal Center (PMMC)","SeaWorld"), values =c("grey0","red","blue","orange","purple"))

t= get_legend(TMMC_Monthly_Plot_Legend)
ggsave(t, file="legend.png", width=10, height =6 , path="~/Google Drive File Stream/My Drive/SCCOOS/CA_HAB_Bulletin/Strandings_Data/Plots" )

```

# HABMAP Shore Stations 
1. Cal Poly Pier
2. Monterey Bay 
3. Newport Pier
3. Santa Cruz Wharf
4. Santa Monica Pier
5. Scripps Pier
6. Stearns Wharf
   
```{r Filter HABMAP Data}

#Cal Poly
Cal_Poly_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/CPP_upload.csv") 

Cal_Poly = Cal_Poly_Org %>%
  mutate(
    Location = `Location Code`,
    Date = `Date Collected (YYYY-MM-DD)`,
    Pn_delicatissima = `Pseudo-nitzschia delicatissima group`,
    Pn_seriata = `Pseudo-nitzschia seriata group`,
    Alexandrium = `Alexandrium spp.`,
    Domoic_Acid = `pDA (ng/mL)`,
    Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y")) %>%
  #        Month = format(as.Date(`Date Collected (YYYY-MM-DD)`, format ="%Y-%m-%d"),"%m"),
  #        Day = format(as.Date(`Date Collected (YYYY-MM-DD)`, format ="%Y-%m-%d"),"%d"))%>%
  select(Location, Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium,Domoic_Acid)
write_csv(Cal_Poly,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/CPP_cleanedup.csv")

#Newport  
Newport_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/NP_upload.csv") 

Newport = Newport_Org %>%
  mutate(Location = `Location Code`,
         Date = `Date Collected (YYYY-MM-DD)`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `pDA (ng/mL)`,
         Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y"))%>%
  select(Location, Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium,Domoic_Acid)
write_csv(Newport,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/NPP_cleanedup.csv")

#Monterey  
Monterey_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_04/HABMAP_data/MW_upload.csv") 

Monterey = Monterey_Org %>%
  mutate(Location = `Location Code`,
         Date = `Date Collected (YYYY-MM-DD)`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `pDA (ng/mL)`,
         Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y"))%>%
  select(Location, Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium,Domoic_Acid)
write_csv(Monterey,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/MW_cleanedup.csv")

#Santa Cruz - No data for Pn Deli 
Santa_Cruz_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SCW_upload.csv") 

Santa_Cruz = Santa_Cruz_Org %>% #353x10
  mutate(Location = `Location Code`,
         Date = `Date Collected (YYYY-MM-DD)`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `pDA (ng/mL)`,
         Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y"))%>%
  select(Location,Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)
write_csv(Santa_Cruz,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SCW_cleanedup.csv")

#Santa Monica  - No Silicate, listed as 'Dissolved Silicon'
Santa_Monica_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SMP_upload.csv")

Santa_Monica = Santa_Monica_Org %>% 
    mutate(Location = `Location Code`,
         Date = `Date Collected (YYYY-MM-DD)`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `pDA (ng/mL)`,
         Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y")) %>%
  select(Location, Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)

write_csv(Santa_Monica,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SMP_cleanedup.csv")

#Stearns Wharf 
Stearn_Wharf_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SW_upload.csv")

Stearn_Wharf = Stearn_Wharf_Org %>%
  mutate(Location = `Location Code`,
         Date = `Date Collected (YYYY-MM-DD)`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `pDA (ng/mL)`,
         Year = format(as.Date(Date, format ="%Y-%m-%d"),"%Y")) %>%
  select(Location,Year, Date, Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)
write_csv(Stearn_Wharf,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SW_cleanedup.csv")

#Scripps Pier - Data Currently is unavailable 
Scripps_Pier_Org = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SP_upload.csv")

Scripps_Pier = Scripps_Pier_Org %>%
  mutate(Location = `Location Code`,
         Date = `Date Collected`,
         Pn_delicatissima = `Pseudo-nitzschia delicatissima group (cells/L)`,
         Pn_seriata = `Pseudo-nitzschia seriata group (cells/L)`,
         Alexandrium = `Alexandrium spp. (cells/L)`,
         Domoic_Acid = `Domoic Acid (ng/mL)`) %>%
  select(Location, Date, Temperature, Chlorophyll, Nitrate, Phosphate, Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)
write_csv(Scripps_Pier,"/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HABMAP_data/SP_cleanedup.csv")

```

##HAB Species and DA Plots

```{r Cal Poly}

#Cal Poly Pier
Cal_Poly_HAB = Cal_Poly %>% 
  filter(Year %in% c("2018","2019")) %>% #Keep all 2018 and 2019 data 
  select(Date,Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)

Cal_Poly_HAB_Plot = 
  ggplot(Cal_Poly_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Cal Poly Pier HAB and DA Data", 
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Cal_Poly_DA_Plot = 
  ggplot(Cal_Poly_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
  geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_text(angle = 90, hjust = 1),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Cal_Poly_Combo_Plot = plot_grid(Cal_Poly_HAB_Plot, Cal_Poly_DA_Plot, align="v", nrow=2, rel_heights = c(1, 4/5))

save_plot("Cal_Poly_Combo_Plot.png", Cal_Poly_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")

```

```{r Newport Pier}

#Newport Pier
Newport_HAB = Newport %>% 
  filter(Year %in% c("2018","2019")) %>% #Keep all 2018 and 2019 data 
  mutate(Pn_delicatissima = as.integer(Pn_delicatissima),
         Pn_seriata = as.integer(Pn_seriata),
         Alexandrium = as.integer(Alexandrium),
         Domoic_Acid = as.integer(Domoic_Acid))

Newport_HAB_Pot = 
  ggplot(Newport, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Newport Pier HAB and DA Data", 
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  scale_y_continuous(limits=c(0,30000))+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Newport_DA_Pot = 
  ggplot(Newport, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
  geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  scale_y_continuous(limits=c(0,1))+ ##again IDK why it is plotting funny!! 
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_text(angle = 90, hjust = 1),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Newport_Combo_Plot = plot_grid(Newport_HAB_Pot,Newport_DA_Pot, align="v",nrow=2, rel_heights = c(1, 4/5))

save_plot("Newport_Combo_Plot.png",Newport_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")

```

```{r Santa Cruz}

Santa_Cruz_HAB = Santa_Cruz %>% #41x8
  filter(Year %in% c("2018","2019"))%>% #Keep all 2018 and 2019 data 
  #select(Date,Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)%>%
  mutate(Pn_delicatissima = as.integer(Pn_delicatissima))

Santa_Cruz_HAB_Plot = 
  ggplot(Santa_Cruz_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"),  size=3) + #color="dodgerblue",
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) + 
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"),  size=3)+ #color="limegreen",
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"),  size=1)+ #color="goldenrod",
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Santa Cruz Municipal Wharf HAB and DA Data",  
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Santa_Cruz_DA_Plot = 
  ggplot(Santa_Cruz_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
  geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  #scale_y_continuous(limits=c(0,1))+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_text(angle = 90, hjust = 1),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))
  
Santa_Cruz_Combo_Plot = plot_grid(Santa_Cruz_HAB_Plot,Santa_Cruz_DA_Plot, align="v",nrow=2, rel_heights = c(1, 4/5))
save_plot("Santa_Cruz_Combo_Plot.png", Santa_Cruz_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")

```

```{r Santa Monica}
#Santa Monica Pier 

Santa_Monica_HAB = Santa_Monica %>%
  filter(Year %in% c("2018","2019")) #Keep all 2018 and 2019 data 
  #mutate(Pn_delicatissima = as.numeric(Pn_delicatissima),
   #     Pn_seriata = as.integer(Pn_seriata),
    #    Alexandrium = as.integer(Alexandrium),
    #    Domoic_Acid = as.integer(Domoic_Acid)) 
  #mutate(Date = as.Date(Date))%>% 
  #select(Date,Pn_delicatissima, Pn_seriata, Alexandrium,Domoic_Acid) 

Santa_Monica_HAB_Plot = 
  ggplot(Santa_Monica_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Santa Monica Pier HAB and DA Data",  
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  #scale_y_continuous(
    #limits = c(0, 10000))+ 
    #breaks = c(0,5,10,15,20,25,30,35,40,45, 50), 
    #labels=c("0","5","10","15","20","25","30","35","40","45","50"))+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Santa_Monica_DA_Plot = 
  ggplot(Santa_Monica_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
  geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  scale_y_continuous(limits=c(0,1))+ ##again IDK why it is plotting funny!! 
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Santa_Monica_Combo_Plot = plot_grid(Santa_Monica_HAB_Plot, Santa_Monica_DA_Plot, align="v",nrow=2, rel_heights = c(1, 4/5))
save_plot("Santa_Monica_Combo_Plot.png",Santa_Monica_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")

```

```{r Stearns Wharf}

Stearns_Wharf_HAB = Stearn_Wharf %>% 
  filter(Year %in% c("2018","2019"))%>% #Keep all 2018 and 2019 data 
  #select(Date,Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid)%>%
  mutate(Domoic_Acid= as.double(Domoic_Acid))
  #mutate(Domoic_Acid = Domoic_Acid*1000) #convert DA to ng/L

Stearns_Wharf_HAB_Plot = 
  ggplot(Stearns_Wharf_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Stearns Wharf HAB and DA Data",  
       x="",
       y="cells/L",
       color = "")+
  #scale_y_continuous(limits = c(0,9000))+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

 Stearns_Wharf_DA_Plot = 
  ggplot(Stearns_Wharf_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
   geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  #expand_limits(y=0)+
  scale_y_continuous(limits = c(0,1))+ ##NO IDEA WHY IT WONT ACCEPT limits=c(0,NA)
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-31")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))
   
Stearns_Wharf_Combo_Plot = plot_grid(Stearns_Wharf_HAB_Plot,Stearns_Wharf_DA_Plot, align="v",nrow=2, rel_heights = c(1, 4/5))
save_plot("Stearns_Wharf_Combo_Plot.png", Stearns_Wharf_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")

```

```{r Scripps Pier}

Scripps_Pier_HAB = Scripps_Pier %>% 
  filter(Year %in% c("2018","2019")) %>% #Keep all 2018 and 2019 data 
  select(Date, Pn_delicatissima, Pn_seriata, Alexandrium, Domoic_Acid) %>%
  mutate(Pn_delicatissima= as.numeric(Pn_delicatissima))%>%
  mutate(Pn_seriata= as.numeric(Pn_seriata)) %>%
  mutate(Alexandrium= as.numeric(Alexandrium)) %>%
  mutate(Domoic_Acid= as.numeric(Domoic_Acid)) 
  #mutate(Domoic_Acid = Domoic_Acid*1000) #convert DA to ng/L
  
Scripps_Pier_HAB_Plot = 
  ggplot(Scripps_Pier_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Scripps Pier HAB and DA Data",  
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-04-01","2019-04-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Scripps_Pier_DA_Plot = 
  ggplot(Scripps_Pier_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
   geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  #expand_limits(y=0)+
  scale_y_continuous(limits = c(0,1))+ ##NO IDEA WHY IT WONT ACCEPT limits=c(0,NA)
  scale_x_date(
    limits = as.Date(c("2018-04-01","2019-04-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))
   
Scripps_Pier_Combo_Plot = plot_grid(Scripps_Pier_HAB_Plot,Scripps_Pier_DA_Plot, align="v",nrow=2, rel_heights = c(1, 4/5))
save_plot("Scripps_Pier_Combo_Plot.png",Scripps_Pier_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_04/HAB_plots")
```

```{r Monterey Pier}

Monterey_Pier_HAB = Monterey %>% 
  filter(Year %in% c("2018","2019")) %>% #Keep all 2018 and 2019 data 
  #mutate(Pn_delicatissima= as.double(Pn_delicatissima))%>%
  #mutate(Pn_seriata= as.double(Pn_seriata)) %>%
  #mutate(Alexandrium= as.double(Alexandrium)) %>%
  mutate(Domoic_Acid= as.double(Domoic_Acid)) 
  
Monterey_Pier_HAB_Plot = 
  ggplot(Monterey_Pier_HAB, aes(x=Date))+
  geom_point(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=3) +
  geom_line(aes(y=Pn_delicatissima, color="Pseudo-nitzschia 'delicatissima' size class (cells/L)"), size=1) +
  geom_point(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=3)+
  geom_line(aes(y=Pn_seriata,color="Pseudo-nitzschia 'seriata' size class (cells/L)"), size=1)+
  geom_point(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=3)+
  geom_line(aes(y=Alexandrium, color="Alexandrium spp. (cells/L)"), size=1)+
  geom_hline(yintercept = 10000, linetype="dashed", color ="black")+ #add horizontal line at 10,000 cells/L 
  #scale_y_continuous(name=expression(paste(italic("Pseudo-nitzschia"), " spp. (cells/L)")), 
                     #sec.axis = sec_axis(~./100, name=expression(paste(italic("Alexandrium")," spp. (cells/L)"))))+ #add second axis 
  scale_color_manual(
    labels =c(expression(paste(italic("Alexandrium")," spp. (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'delicatissima' size class (cells/L)")),
              expression(paste(italic("Pseudo-nitzschia")," 'seriata' size class (cells/L)"))), 
    values =c("goldenrod", "dodgerblue","limegreen"))+
  labs(title= "Monterey Pier HAB and DA Data",  
       x="",
       y="cells/L",
       color = "")+
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(1, 1, 0, 1), "cm"), #trbl
    legend.position = c(0.7,0.8), #c(0.85,0.9)
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    #axis.text.x = element_blank(),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))

Monterey_Pier_DA_Plot = 
  ggplot(Monterey_Pier_HAB, aes(x=Date))+
  geom_point(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=3)+
   geom_line(aes(y=Domoic_Acid, color="Domoic Acid (ng/L)"),size=1)+
  labs(title= "", x="", y="ng/L", color = "")+
  scale_color_manual(
    labels =c("Domoic Acid (ng/L)"), 
    values =c("darkorange"))+
  #expand_limits(y=0)+
  scale_y_continuous(limits = c(0,1))+ ##NO IDEA WHY IT WONT ACCEPT limits=c(0,NA)
  scale_x_date(
    limits = as.Date(c("2018-06-01","2019-06-30")),
    labels= date_format("%b %y"),
    date_breaks = "months")+
  theme_bw()+
  theme(
    plot.margin = unit(c(0, 1, 1, 1), "cm"), 
    legend.position = c(0.85,0.8),
    legend.background = element_rect(color = "black", size=0.2, linetype="solid"),
    legend.title = element_blank(),
    legend.justification = "center",
    legend.margin = margin(0.25,0.25,0.25,0.25,unit="cm"),
    legend.text = element_text(size=12, vjust=0.5, hjust=0.5), #hjust = 0, vjust = 0
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    plot.title = element_text(hjust=0.5),
    title=element_text(size=14))
   
Monterey_Combo_Plot = plot_grid(Monterey_Pier_HAB_Plot, Monterey_Pier_DA_Plot, align="v",nrow=2, rel_heights = c(1, 4/5))
save_plot("Monterey_Pier_Combo_Plot.png",Monterey_Combo_Plot, base_width = 10, base_height = 8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_06/HAB_plots")
```
Parsed with column specification:cols(
  Location = col_character(),
  Date = col_date(format = ""),
  Temperature = col_character(),
  Chlorophyll = col_character(),
  Nitrate = col_character(),
  Phosphate = col_character(),
  Silicate = col_character(),
  Pn_delicatissima = col_character(),
  Pn_seriata = col_character(),
  Alexandrium = col_character(),
  Domoic_Acid = col_character(),
  Year = col_double(),
  Month = col_character(),
  Day = col_character())

```{r Shore Station timeseries data}

Cal_Poly = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Cal_Poly_cleanedup.csv") #537x14
Newport = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Newport_cleanedup.csv") #539x14
Santa_Cruz = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Santa_Cruz_cleanedup.csv") #363x14
Santa_Monica = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Santa_Monica_cleanedup.csv") #548x14
Stearns_Wharf = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Stearn_Wharf_cleanedup.csv") #537x14
Scripps = read_csv("/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/2019_01/HABMAP_data/Scripps_Pier_cleanedup.csv") #558x14

Cal_Poly_DA = Cal_Poly %>%
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  mutate(Year = as.integer(Year),
         Month = as.integer(Month),
         year_month = make_datetime(Year, Month))%>% 
  group_by(year_month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Newport_DA = Newport %>% 
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  mutate(Year = as.integer(Year),
         Month = as.integer(Month),
         Year_Month = make_datetime(Year, Month))%>% 
  group_by(Year_Month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Santa_Cruz_DA = Santa_Cruz %>% 
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  group_by(Year, Month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Santa_Monica_DA = Santa_Monica %>% 
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  group_by(Year, Month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Stearns_Wharf_DA = Stearns_Wharf %>%
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  group_by(Year, Month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Scripps_DA = Scripps %>% 
  select(Location, Date, Year, Month, Domoic_Acid) %>%
  group_by(Year, Month) %>% 
    summarize(
      Domoic_Acid_mean = mean(Domoic_Acid),
      Domoic_Acid_n = length(Domoic_Acid),
      Domoic_Acid_sd = sd(Domoic_Acid),
      Domoic_Acid_se = Domoic_Acid_sd /sqrt(Domoic_Acid_n)) 

Santa_Cruz_DA_TS = ggplot(Santa_Cruz)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="goldenrod")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")), #min  "2008-08-15"
    labels= date_format("%Y"),
    date_breaks = "years")+ #date_minor_breaks = "1 month"
  labs(title= "Santa Cruz Municipal Wharf Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Santa_Cruz_DA_timeseries.png", plot=Santa_Cruz_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/")

Cal_Poly_DA_TS = ggplot(Cal_Poly)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="black")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")), #min  "2008-08-15"
    labels= date_format("%Y"),
    date_breaks = "years")+ #date_minor_breaks = "1 month"
  labs(title= "Cal Poly Pier Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Cal_Poly_DA_timeseries.png", plot=Cal_Poly_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/") 

Stearns_DA_TS = ggplot(Stearns_Wharf)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="orange")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")), #min  "2008-08-15"
    labels= date_format("%Y"),
    date_breaks = "years")+ #date_minor_breaks = "1 month"
  labs(title= "Stearns Wharf Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Stearns_DA_timeseries.png", plot=Stearns_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/") 

Santa_Monica_DA_TS = ggplot(Santa_Monica)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="red")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")), #min  "2008-08-15"
    labels= date_format("%Y"),
    date_breaks = "years")+ #date_minor_breaks = "1 month"
  labs(title= "Santa Monica Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Santa_Monica_DA_timeseries.png", plot=Santa_Monica_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/")

Newpoer_DA_TS = ggplot(Newport)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="blue")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")),
    labels= date_format("%Y"),
    date_breaks = "years",
    minor_breaks = "months")+
  labs(title= "Newport Pier Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Newport_DA_timeseries.png", plot=Newpoer_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/")

Scripps_DA_TS = ggplot(Scripps)+
  geom_line(aes(x=Date, y=Domoic_Acid),size=1, color="purple")+
  scale_x_date(
    limits = as.Date(c("2008-06-01","2019-01-31")), #min  "2008-08-15"
    labels= date_format("%Y"),
    date_breaks = "years")+ #date_minor_breaks = "1 month"
  labs(title= "Scripps Domoic Acid", x="Year", y="Domoic Acid (ng/L)")+
  theme_bw()+
  theme(
    legend.position="none",
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    axis.title.x=element_text(size=14),
    axis.title.y=element_text(size=14),
    title=element_text(size=16),
    plot.title=element_text(hjust=0.5))
ggsave(file="Scripps_DA_timeseries.png", plot=Scripps_DA_TS, width=12, height=8, path="/Volumes/GoogleDrive/My Drive/SCCOOS/CA_HAB_Bulletin/DA_timeseries_plots/")

```